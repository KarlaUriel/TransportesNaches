<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Contabilidad - Transportes Naches</title>
        <link rel="icon" type="image/png" sizes="16x16" href="/Resource/transportesNaches.png">
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
        <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
        <script>
            tailwind.config = {
                theme: {
                    extend: {
                        colors: {
                            'primary-orange': '#f97316',
                            'secondary-orange': '#fb923c',
                            'dark-bg-start': '#1a202c',
                            'dark-bg-end': '#2d3748',
                            'accent-blue': '#1e40af',
                            'accent-blue-hover': '#1e3a8a'
                        }
                    }
                }
            }
        </script>
        <style>
            .tooltip {
                position: relative;
                display: inline-block;
            }
            .tooltip .tooltiptext {
                visibility: hidden;
                width: auto;
                background-color: #4a5568;
                color: #fff;
                text-align: center;
                border-radius: 6px;
                padding: 5px 10px;
                position: absolute;
                z-index: 1;
                left: 110%;
                opacity: 0;
                transition: opacity 0.3s;
                white-space: nowrap;
            }
            .tooltip:hover .tooltiptext {
                visibility: visible;
                opacity: 1;
            }
            .card {
                @apply bg-white border border-gray-200 rounded-lg shadow-md;
                transition: transform 0.2s, box-shadow 0.2s;
            }
            .card:hover {
                @apply shadow-lg transform -translate-y-1;
            }
            .modal {
                display: none;
                position: fixed;
                z-index: 50;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                overflow: auto;
                background-color: rgba(0,0,0,0.4);
            }
            .modal-content {
                background-color: #fff;
                margin: 5% auto;
                padding: 20px;
                border: 1px solid #888;
                width: 90%;
                max-width: 900px;
                border-radius: 10px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                max-height: 85vh;
                overflow-y: auto;
            }
            .close {
                color: #aaa;
                float: right;
                font-size: 28px;
                font-weight: bold;
            }
            .close:hover,
            .close:focus {
                color: black;
                text-decoration: none;
                cursor: pointer;
            }
            .action-btn {
                font-size: 0.875rem;
                padding: 0.75rem 1.5rem;
                border-radius: 0.5rem;
                transition: all 0.3s ease;
                width: 100%;
                text-align: center;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                border: none;
                font-weight: 500;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.5rem;
            }
            .action-btn:hover {
                transform: translateY(-1px);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            }
            @media (min-width: 640px) {
                .action-btn {
                    width: auto;
                    padding: 0.75rem 2rem;
                    font-size: 1rem;
                }
            }
            .filter-btn {
                background-color: #1e40af;
                color: white;
                padding: 0.75rem 1.5rem;
                border-radius: 0.5rem;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                font-weight: 500;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.5rem;
            }
            .filter-btn:hover {
                background-color: #1e3a8a;
                transform: translateY(-1px);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            }
            .filter-panel {
                position: fixed;
                top: 0;
                right: -350px;
                width: 350px;
                height: 100%;
                background: rgba(31, 41, 55, 0.9);
                z-index: 50;
                transition: right 0.3s ease-in-out;
                box-shadow: -4px 0 12px rgba(0, 0, 0, 0.3);
                backdrop-filter: blur(5px);
                overflow-y: auto;
            }
            .filter-panel.open {
                right: 0;
            }
            .filter-panel-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 1rem 1.5rem;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }
            .filter-panel-content {
                padding: 1.5rem;
            }
            .filter-select {
                background-color: rgba(55, 65, 81, 0.8);
                border: 1px solid rgba(75, 85, 99, 0.5);
                color: white;
                border-radius: 0.5rem;
                padding: 0.5rem;
                width: 100%;
                transition: border-color 0.3s ease;
            }
            .filter-select:focus {
                outline: none;
                border-color: #3b82f6;
                box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
            }
            .custom-btn {
                background: linear-gradient(90deg, #4b6cb7, #182848);
                color: white;
                padding: 0.75rem 1.5rem;
                border-radius: 0.5rem;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.5rem;
                font-weight: 600;
            }
            .custom-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
                background: linear-gradient(90deg, #5a7cc4, #1e3a8a);
            }
            .custom-btn.green {
                background: linear-gradient(90deg, #10b981, #064e3b);
            }
            .custom-btn.green:hover {
                background: linear-gradient(90deg, #14d8a4, #0a7c5c);
            }
            .custom-btn.blue {
                background: linear-gradient(90deg, #3b82f6, #1e40af);
            }
            .custom-btn.blue:hover {
                background: linear-gradient(90deg, #60a5fa, #1e3a8a);
            }
            .custom-btn.orange {
                background: linear-gradient(90deg, #f97316, #ea580c);
            }
            .custom-btn.orange:hover {
                background: linear-gradient(90deg, #fb923c, #c2410c);
            }
            /* Enhanced Financial Summary Styles */
            .financial-panel {
                @apply bg-white border border-gray-200 rounded-xl shadow-md p-6 mb-6;
                transition: transform 0.2s, box-shadow 0.2s;
            }
            .financial-panel:hover {
                @apply shadow-lg;
                transform: translateY(-2px);
            }
            .financial-header {
                @apply text-2xl font-bold text-gray-800 mb-4 border-b-2 border-primary-orange pb-2 flex items-center gap-2;
            }
            .financial-subheader {
                @apply text-lg font-semibold text-gray-700 mb-3 border-l-4 border-primary-orange pl-3;
            }
            .financial-table {
                @apply w-full border border-gray-300 rounded-lg overflow-hidden;
            }
            .financial-table th,
            .financial-table td {
                @apply py-3 px-4 text-left border-b border-gray-200;
            }
            .financial-table th {
                @apply bg-primary-orange text-white font-semibold;
            }
            .financial-table td {
                @apply text-gray-800;
            }
            .financial-table tr:hover {
                @apply bg-gray-50;
            }
            .financial-table .value {
                @apply font-medium;
            }
            .negative {
                @apply text-red-600 font-semibold;
            }
            .positive {
                @apply text-green-600 font-semibold;
            }
            .kpi-card {
                @apply bg-gradient-to-r from-gray-50 to-gray-100 border border-gray-200 p-4 rounded-lg shadow-sm flex-1 text-center hover-shadow-md transition-shadow;
            }
            .kpi-card h4 {
                @apply text-sm font-medium text-gray-600 mb-1;
            }
            .kpi-card p {
                @apply text-xl font-bold text-gray-800;
            }
            .chart-container {
                @apply bg-white border border-gray-200 rounded-lg p-4 shadow-sm;
                max-height: 300px !important;
                max-width: 100% !important;
                overflow: hidden;
                position: relative;
            }
            .chart-container canvas {
                @apply w-full h-full;
            }
            .card-content {
                @apply p-4;
            }

            .widget-label h3 {
                @apply text-lg font-semibold text-gray-700;
            }

            .widget-icon {
                @apply text-2xl;
            }

            table {
                @apply w-full text-sm;
            }

            table thead tr {
                @apply bg-blue-100;
            }

            table th {
                @apply py-2 px-4 font-semibold text-gray-700;
            }

            table td {
                @apply py-2 px-4;
            }

            table tr:hover {
                @apply bg-gray-50;
            }

            #resumenFinancieroModal .modal-content {
                @apply bg-gray-50;
                max-width: 95vw !important;
                max-height: 90vh !important;
                overflow-y: auto;
            }
        </style>
    </head>
    <body class="h-screen bg-gradient-to-r from-orange-400 to-orange-700 overflow-x-hidden">
        <div class="md:hidden fixed top-4 left-4 z-50 bg-transparent">
            <button id="menuButton" onclick="toggleSidebar()" class="text-white text-3xl bg-transparent">
                <i id="menu-icon" class="fas fa-bars"></i>
            </button>
        </div>
        <div class="flex h-full w-full">
            <nav id="sidebar" class="fixed md:relative z-40 w-16 h-full flex flex-col items-center py-4 shadow-2xl transform -translate-x-full md:translate-x-0 transition-transform duration-300" style="background: linear-gradient(to bottom, #1a202c, #2d3748)">
                <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center shadow-md border-2 border-orange-400 mb-8">
                    <a href="/menu">
                        <img src="/Resource/transportesNaches.png" alt="logo" class="w-6 h-6 rounded-full hover:opacity-80 transition" />
                    </a>
                </div>
                <ul class="w-full px-2 space-y-6 flex-grow">
                    <li id="bitacora" class="tooltip">
                        <a href="/bitacora" class="flex items-center justify-center p-3 text-white hover:text-orange-300 transition-colors">
                            <i class="fas fa-book text-xl"></i>
                            <span class="tooltiptext">Bitácora</span>
                        </a>
                    </li>
                    <li class="admin-only tooltip" id="contabilidad">
                        <a href="/contabilidad" class="flex items-center justify-center p-3 text-white hover:text-orange-300 transition-colors">
                            <i class="fas fa-calculator text-xl"></i>
                            <span class="tooltiptext">Contabilidad</span>
                        </a>
                    </li>
                    <li id="gestionAdmin" class="admin-only tooltip">
                        <button onclick="toggleGestionMenu()" class="flex items-center justify-center p-3 text-white hover:text-orange-300 transition-colors w-full">
                            <i class="fas fa-cogs text-xl"></i>
                            <span class="tooltiptext">Gestión</span>
                        </button>
                        <ul id="gestionSubmenu" class="hidden absolute left-16 top-0 bg-gray-800 text-white rounded-md shadow-lg py-2 w-48 space-y-2 z-50">
                            <li><a href="/cliente" class="block px-4 py-2 hover:bg-orange-500">Gestión Cliente</a></li>
                            <li><a href="/unidad" class="block px-4 py-2 hover:bg-orange-500">Gestión Unidad</a></li>
                            <li><a href="/empleado" class="block px-4 py-2 hover:bg-orange-500">Gestión Empleado</a></li>
                            <li><a href="/ciudad" class="block px-4 py-2 hover:bg-orange-500">Gestión Ciudad</a></li>
                            <li><a href="/caseta" class="block px-4 py-2 hover:bg-orange-500">Gestión Caseta</a></li>
                        </ul>
                    </li>
                </ul>
                <div class="mt-16 mb-4 tooltip">
                    <button id="cerrarSesion" class="flex items-center justify-center p-3 text-white hover:text-red-300 transition-colors">
                        <i class="fas fa-sign-out-alt text-xl"></i>
                        <span class="tooltiptext">Cerrar Sesión</span>
                    </button>
                </div>
            </nav>
            <main class="flex-1 p-6 overflow-auto md:mt-0 mt-16">
                <div class="bg-white rounded-xl shadow-2xl p-4 sm:p-6 max-w-full mx-auto">
                    <h1 class="text-center text-xl sm:text-2xl font-bold text-gray-800 bg-orange-200 py-2 px-4 rounded-lg mb-4 sm:mb-6">
                        Registro de Notas
                    </h1>
                    <div class="mb-4 sm:mb-6">
                        <!-- Search Bar -->
                        <div class="flex justify-end mb-2">
                            <input type="text" id="searchBar" placeholder="Buscar por cliente, operador, ruta, etc." class="border-2 border-gray-300 rounded-lg p-2 w-full sm:w-1/2 focus:outline-none focus:ring-2 focus:ring-orange-400">
                        </div>
                        <!-- Action Buttons -->
                        <div class="flex flex-col sm:flex-row items-center sm:justify-end space-y-4 sm:space-y-0 sm:space-x-4">
                            <button id="toggleFilterPanel" class="filter-btn flex items-center space-x-2">
                                <i class="fas fa-filter"></i>
                                <span>Advanced Filters</span>
                            </button>
                            <button id="mostrarResumenBtn" class="custom-btn green">
                                <i class="fas fa-chart-pie"></i>
                                <span>Resumen Financiero</span>
                            </button>
                            <button id="gastosAnualesBtn" class="custom-btn blue">
                                <i class="fas fa-money-bill-wave"></i>
                                <span>Gastos Anuales</span>
                            </button>
                            <button id="descargarExcel" class="custom-btn orange">
                                <i class="fas fa-file-excel"></i>
                                <span>Descargar Excel</span>
                            </button>
                        </div>
                    </div>
                    <div id="notasContainer" class="space-y-4">
                        <!-- Las tarjetas se generarán aquí -->
                    </div>
                    <div id="cargarMasContainer" class="flex justify-center mt-4">
                        <button id="cargarMasBtn" class="action-btn bg-primary-orange text-white hover:bg-secondary-orange hidden">
                            Cargar más
                        </button>
                    </div>
                </div>

                <!-- Filter Panel -->
                <div id="filterPanel" class="filter-panel">
                    <div class="filter-panel-header">
                        <h2 class="text-xl font-bold text-white">Advanced Filters</h2>
                        <button id="closeFilterPanel" class="text-white text-2xl">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="filter-panel-content">
                        <div class="space-y-6">
                            <div>
                                <label for="filtroMes" class="block text-gray-300 font-semibold mb-2">Filtrar por mes:</label>
                                <select id="filtroMes" class="filter-select">
                                    <option value="todos">Todos los meses</option>
                                </select>
                            </div>
                            <div>
                                <label for="filtroSemana" class="block text-gray-300 font-semibold mb-2">Filtrar por semana:</label>
                                <select id="filtroSemana" class="filter-select">
                                    <option value="todos">Todas las semanas</option>
                                </select>
                            </div>
                            <div>
                                <label for="filtroOperador" class="block text-gray-300 font-semibold mb-2">Filtrar por operador:</label>
                                <select id="filtroOperador" class="filter-select">
                                    <option value="todos">Todos los operadores</option>
                                </select>
                            </div>
                            <div>
                                <label for="filtroCliente" class="block text-gray-300 font-semibold mb-2">Filtrar por cliente:</label>
                                <select id="filtroCliente" class="filter-select">
                                    <option value="todos">Todos los clientes</option>
                                </select>
                            </div>
                            <div class="flex space-x-4">
                                <button id="applyFiltersBtn" class="action-btn bg-blue-600 text-white hover:bg-blue-700 w-full">
                                    Apply Filters
                                </button>
                                <button id="clearFiltersBtn" class="action-btn bg-gray-600 text-white hover:bg-gray-700 w-full">
                                    Clear Filters
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal para Gastos Anuales -->
                <div id="gastosAnualesModal" class="modal">
                    <div class="modal-content">
                        <span id="spanGastos" class="close">×</span>
                        <h2 class="text-xl font-bold text-gray-800 mb-4">Gestión de Gastos Anuales</h2>
                        <div id="gastosFormContainer">
                            <form id="gastosAnualesForm" class="mb-6">
                                <input type="hidden" id="idGastoAnual" value="">
                                <div class="mb-4">
                                    <label for="descripcionGasto" class="block text-gray-800 font-semibold">Descripción:</label>
                                    <input type="text" id="descripcionGasto" class="border-2 border-orange-300 rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-orange-400" required>
                                </div>
                                <div class="mb-4">
                                    <label for="montoGasto" class="block text-gray-800 font-semibold">Monto Anual ($):</label>
                                    <input type="number" id="montoGasto" step="0.01" class="border-2 border-orange-300 rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-orange-400" required>
                                </div>
                                <div class="mb-4">
                                    <label for="anioGasto" class="block text-gray-800 font-semibold">Año:</label>
                                    <input type="number" id="anioGasto" class="border-2 border-orange-300 rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-orange-400" required>
                                </div>
                                <div class="mb-4">
                                    <label for="fechaInicio" class="block text-gray-800 font-semibold">Fecha de Inicio:</label>
                                    <input type="date" id="fechaInicio" class="border-2 border-orange-300 rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-orange-400" required>
                                </div>
                                <div class="mb-4">
                                    <label for="fechasPago" class="block text-gray-800 font-semibold">Fechas de Pago:</label>
                                    <input type="text" id="fechasPago" class="border-2 border-orange-300 rounded-lg p-2 w-full focus:outline-none focus:ring-2 focus:ring-orange-400" required>
                                </div>
                                <button type="submit" id="submitGastoBtn" class="bg-primary-orange text-white py-2 px-4 rounded-lg hover:bg-secondary-orange transition">Guardar</button>
                                <button type="button" id="cancelEditBtn" class="bg-gray-500 text-white py-2 px-4 rounded-lg hover:bg-gray-600 transition hidden">Cancelar Edición</button>
                            </form>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">Gastos Registrados</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white border border-gray-300">
                                <thead>
                                    <tr class="bg-orange-200">
                                        <th class="py-2 px-4 border-b text-left">Descripción</th>
                                        <th class="py-2 px-4 border-b text-left">Monto Anual ($)</th>
                                        <th class="py-2 px-4 border-b text-left">Año</th>
                                        <th class="py-2 px-4 border-b text-left">Fecha de Inicio</th>
                                        <th class="py-2 px-4 border-b text-left">Fechas de Pago</th>
                                        <th class="py-2 px-4 border-b text-left">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="gastosAnualesTableBody">
                                    <!-- Los gastos se generarán aquí -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

              

            </main>
        </div>
        <script>
            function toggleSidebar() {
                const sidebar = document.getElementById('sidebar');
                const menuIcon = document.getElementById('menu-icon');
                sidebar.classList.toggle('-translate-x-full');
                if (sidebar.classList.contains('-translate-x-full')) {
                    menuIcon.classList.remove('fa-times');
                    menuIcon.classList.add('fa-bars');
                } else {
                    menuIcon.classList.remove('fa-bars');
                    menuIcon.classList.add('fa-times');
                }
            }

            function toggleGestionMenu() {
                const menu = document.getElementById('gestionSubmenu');
                menu.classList.toggle('hidden');
            }

            function toggleFilterPanel() {
                const filterPanel = document.getElementById('filterPanel');
                filterPanel.classList.toggle('open');
            }

            function closeFilterPanel() {
                const filterPanel = document.getElementById('filterPanel');
                filterPanel.classList.remove('open');
            }

            const userRole = 'administrador';
            document.addEventListener('DOMContentLoaded', () => {
                document.querySelectorAll('.admin-only').forEach(el => {
                    el.style.display = userRole === 'administrador' ? '' : 'none';
                });

                // Eventos para el panel de filtros
                document.getElementById('toggleFilterPanel').addEventListener('click', toggleFilterPanel);
                document.getElementById('closeFilterPanel').addEventListener('click', closeFilterPanel);

                // Eventos para modales
                const modalGastos = document.getElementById('gastosAnualesModal');
                const btnGastos = document.getElementById('gastosAnualesBtn');
                const spanGastos = document.getElementById('spanGastos');

                if (btnGastos && modalGastos && spanGastos) {
                    btnGastos.onclick = function () {
                        modalGastos.style.display = 'block';
                    };
                    spanGastos.onclick = function () {
                        modalGastos.style.display = 'none';
                        resetForm();
                    };
                }

              

                window.onclick = function (event) {
                    if (event.target == modalGastos) {
                        modalGastos.style.display = 'none';
                        resetForm();
                    }
                    
                };
            });

            function resetForm() {
                const form = document.getElementById('gastosAnualesForm');
                if (form) {
                    form.reset();
                    document.getElementById('idGastoAnual').value = '';
                    document.getElementById('submitGastoBtn').textContent = 'Guardar';
                    document.getElementById('cancelEditBtn').classList.add('hidden');
                    const fechasPagoInput = document.getElementById('fechasPago');
                    if (fechasPagoInput._flatpickr) {
                        fechasPagoInput._flatpickr.setDate([]);
                    }
                }
            }
        </script>
        <script>
            // Inicialización de gráficos
            document.addEventListener('DOMContentLoaded', () => {
                // Gráfico de Resumen General (Barras)
                const ctxFinancial = document.getElementById('financialChart').getContext('2d');
                const financialChart = new Chart(ctxFinancial, {
                    type: 'bar',
                    data: {
                        labels: ['Ingresos', 'Gastos', 'Ganancia Neta'],
                        datasets: [{
                                label: 'Monto ($)',
                                data: [0, 0, 0],
                                backgroundColor: ['#10b981', '#ef4444', '#3b82f6'],
                                borderColor: ['#064e3b', '#991b1b', '#1e40af'],
                                borderWidth: 1
                            }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Monto ($)'
                                },
                                ticks: {
                                    callback: function (value) {
                                        return new Intl.NumberFormat('es-MX', {style: 'currency', currency: 'MXN'}).format(value);
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'top'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.y !== null) {
                                            label += new Intl.NumberFormat('es-MX', {style: 'currency', currency: 'MXN'}).format(context.parsed.y);
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });

                // Gráfico de Desglose de Gastos (Pastel)
                const ctxExpense = document.getElementById('expenseBreakdownChart').getContext('2d');
                const expenseBreakdownChart = new Chart(ctxExpense, {
                    type: 'pie',
                    data: {
                        labels: ['Operativos', 'Maniobra', 'Comisión', 'Anuales Diarios', 'Anuales Total'],
                        datasets: [{
                                label: 'Gastos ($)',
                                data: [0, 0, 0, 0, 0],
                                backgroundColor: [
                                    '#ff6384',
                                    '#36a2eb',
                                    '#ffcd56',
                                    '#4bc0c0',
                                    '#9966ff'
                                ],
                                borderColor: '#fff',
                                borderWidth: 1
                            }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        let label = context.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed !== null) {
                                            label += new Intl.NumberFormat('es-MX', {style: 'currency', currency: 'MXN'}).format(context.parsed);
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });

                // Funciones para actualizar los gráficos
                window.updateFinancialChart = function (totalIngresos, totalGastos, gananciaNeta) {
                    financialChart.data.datasets[0].data = [totalIngresos, totalGastos, gananciaNeta];
                    financialChart.update();
                };

                window.updateExpenseBreakdownChart = function (gastosOperativos, maniobra, comision, gastosAnualesDiarios, gastosAnualesTotal) {
                    expenseBreakdownChart.data.datasets[0].data = [
                        gastosOperativos,
                        maniobra,
                        comision,
                        gastosAnualesDiarios,
                        gastosAnualesTotal
                    ];
                    expenseBreakdownChart.update();
                };
            });
        </script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
        <script src="/Modules/Menu/controller_Menu.js" type="module"></script>
        <script src="/Modules/Contabilidad/controller_Contabilidad.js" type="module"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    </body>
</html>